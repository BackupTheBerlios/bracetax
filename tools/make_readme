#! /bin/sh

mkdir -p gendoc

# Need an image for the example:
cp `find /usr/share -name "*.png" | head -n 1` gendoc/found_image.png

cp README.brtx gendoc/

# HTMLize with the syntax file:
vim -f -R README.brtx \
    -c "sy on" \
    -c 'colorscheme darkblue' \
    -c 'source tools/bracetax_syntax.vim' \
    -c TOhtml -c 'w!' -c qa
mv README.brtx.html gendoc/

# Generate the XHTML with and without CSS:
bracetax -html -doc -i README.brtx -o gendoc/README_raw.html
bracetax -html -doc -i README.brtx -o gendoc/README_css.html \
    -link-stylesheet basic.css 
cp test/basic.css gendoc/

# HTMLize this script:
vim -f -R  tools/make_readme \
    +'set background=dark' \
    +"syn on"  +'colorscheme darkblue' \
    +"so \\\$VIMRUNTIME/syntax/2html.vim" +"w!" +"qa" 
mv tools/make_readme.html gendoc/


# Exports to LaTeX:
bracetax -doc -latex -i README.brtx -o gendoc/README_latex.tex
bracetax -doc -latex -i README.brtx -o gendoc/README_latex_style.tex \
    -link-stylesheet bracetax
cp test/bracetax.sty gendoc/

# Compile the LaTeX:
cd gendoc
pdflatex README_latex && pdflatex README_latex
pdflatex README_latex_style && pdflatex README_latex_style
cd ..

# Make the index.html:
echo "
{header|
    {title|Bracetax's README}
    {authors|{link http://sebmdt.googlepages.com|Sebastien Mondet}}
    {subtitle|Generated by {t|make_readme}}
}
Here we have:
{begin list}
    {item} The {link README.brtx|source} ({t|README.brtx})
    {item} The {link README_raw.html|generated HTML}
    {item} The {link README_css.html|generated HTML with a CSS}
    {item} The {link README_latex.pdf|generated PDF from LaTeX export}
    {item} The {link README_latex_style.pdf|generated PDF from LaTeX export with a style}
    {item} The {link README.brtx.html|coloured source} (by Vim, c.f. 
        {link README_css.html#sec_tools|Tools})
    {item} The {link make_readme.html|script} that generated this page
{end}
" | bracetax -html -o gendoc/index.html -doc


